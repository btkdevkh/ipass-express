<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/index.js" defer></script>
    <title><%= siteName %> | <%= title %></title>
  </head>
  <body class="bg-slate-950">
    <header class="bg-slate-800 px-3 py-7">
      <nav class="container mx-auto flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="/">
            <h1 class="text-xl border-b-2 border-b-amber-300">
              <%= siteName %>
            </h1>
          </a>
          <img src="/logo.png" alt="logo" width="40px" />
        </div>
        <button class="bg-slate-700 py-2 px-4 hover:bg-slate-600 hidden">
          + iPASS
        </button>
      </nav>
    </header>

    <main class="container mx-auto p-3 md:py-3 md:px-0">
      <div class="flex flex-col gap-5 md:flex-row">
        <div class="flex flex-col items-center gap-3 flex-1">
          <form
            action="<%= password ? '/update/' + password.id : '/add' %>"
            method="post"
            class="w-full h-fit mx-auto flex flex-col gap-3 bg-slate-950 p-5 border border-amber-300"
          >
            <h2 class="text-lg font-semibold">
              <%= password ? 'Modifier ce' : 'Ajouter un' %> mot de passe
            </h2>
            <input
              type="text"
              name="organisation"
              id="organisation"
              placeholder="Organisation"
              class="border border-amber-300 p-3"
              value="<%= password ? password.organisation : '' %>"
            />
            <input
              type="text"
              name="link"
              id="link"
              placeholder="Site"
              class="border border-amber-300 p-3"
              value="<%= password ? password.link : '' %>"
            />
            <input
              type="text"
              name="identification"
              id="identification"
              placeholder="Identifiant"
              class="border border-amber-300 p-3"
              value="<%= password ? password.identification : '' %>"
            />
            <input
              type="password"
              name="password"
              id="password"
              placeholder="Mot de passe"
              class="border border-amber-300 p-3"
              value="<%= password ? password.password : '' %>"
            />

            <input
              type="submit"
              class="bg-amber-300 text-black font-semibold border-none p-3 cursor-pointer"
              value="<%= password ? 'Modifier' : 'Ajouter' %>"
            />
          </form>

          <div
            class="w-full h-fit mx-auto flex flex-col gap-3 bg-slate-950 p-5 border border-amber-300"
          >
            <h2 class="uppercase font-semibold text-red-700">Attention !</h2>

            <p>
              Le risque zéro n'existe pas. Faites des sauvegardes régulières de
              votre base de données sur un support sécurisé.
            </p>
          </div>

          <div
            class="w-full h-fit mx-auto flex flex-col gap-3 bg-slate-950 p-5 border border-[#1c283d]"
          >
            <p>
              &copy; 2025 <%= new Date().getFullYear() === 2025 ? "" : "- " +
              new Date().getFullYear() %> Btkdevkh. Tous droits réservés.
            </p>
          </div>
        </div>

        <div class="flex-3">
          <div class="flex flex-col gap-3">
            <h2 class="font-semibold">Mot de passe</h2>
            <p>
              Créez, enregistrez et gérez vos mots de passe afin de pouvoir vous
              connecter facilement aux sites et aux applications.
            </p>
          </div>
          <br />

          <div
            class="<%= passwords.length === 0 ? 'hidden' : '' %> w-full max-h-[79vh] h-fit mx-auto password-list flex flex-col gap-3 overflow-y-auto border border-[#1c283d] p-1"
          >
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Organisation</th>
                  <th>Site</th>
                  <th>Identifiant</th>
                  <th>Mot de passe</th>
                  <th>Actions</th>
                </tr>
              </thead>

              <tbody id="ipass-list">
                <% passwords.forEach(ipass => { %>
                <tr>
                  <td><i class="fa-solid fa-globe"></i> / <%= ipass.id %></td>
                  <td><%= ipass.organisation %></td>
                  <td>
                    <a href="<%= ipass.link %>" target="_blank"
                      ><%= ipass.link ? ipass.link : "n/a" %></a
                    >
                  </td>
                  <td>
                    <%= ipass.identification ? ipass.identification : "n/a" %>
                  </td>
                  <td>
                    <div
                      class="toggle-eye flex justify-center items-center gap-3"
                    >
                      <span
                        ><%= ipass.password ? '************' : 'n/a' %></span
                      >
                      <button
                        type="button"
                        data-id="<%= ipass.id %>"
                        class="border-none cursor-pointer"
                      >
                        <i class="fa-solid fa-eye-slash"></i>
                      </button>
                    </div>
                  </td>
                  <td>
                    <div class="actions flex gap-2 items-center justify-center">
                      <form action="/update/ui/<%= ipass.id %>" method="get">
                        <button
                          type="submit"
                          class="bg-orange-500 text-white py-1 px-2 cursor-pointer border-none delete"
                        >
                          <i class="fa-solid fa-pencil"></i>
                        </button>
                      </form>

                      <form
                        action="/delete/<%= ipass.id %>"
                        method="post"
                        onsubmit="return confirm('Are you sure you want to delete this password?');"
                      >
                        <button
                          type="submit"
                          class="bg-red-600 text-white py-1 px-2 cursor-pointer border-none delete"
                        >
                          <i class="fa-solid fa-xmark"></i>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
